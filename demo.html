<!DOCTYPE html>
<html lang="en">
    
    <head>
        <meta charset="UTF-8">
        <title>Tern.Ace demo</title>
        <style type="text/css" media="screen">
            body {
                overflow: hidden;
                background-color: #EFEFEF;
            }
            #editor {
                margin: 0;
                position: absolute;
                top: 0;
                bottom: 0;
                right: 320px;
                left: 0;
                border-right:1px solid black;
            }
            #issues {
                position: absolute;
                top:30px;
                bottom: 10px;
                right: 10px;
                width:300px;
                font-size:12px;
            }
            .hotkeys td{
                vertical-align: top;
            }
            .hotkeys tr td:nth-child(2){
                padding-left:7px;
            }
            h3{
                margin-top: 20px;
                margin-bottom: 3px
            };
            .test{}
        </style>
    </head>
    
    <body>
        <pre id="editor"></pre>
        <div id="issues" style="overflow:auto;">
            <a href="https://github.com/sevin7676/Ace.Tern" target="_blank">https://github.com/sevin7676/Ace.Tern</a>
            <br/>
            <br/>Mode:
            <select id="modeSelect" onchange="ChangeMode();">
                <option>javascript</option>
                <option>html</option>
            </select>
            <h3>Demo Hot Keys</h3>
            <table class="hotkeys">
                <tr style="font-weight:bold;">
                    <td>Key</td>
                    <td>Description</td>
                </tr>
                <tr>
                    <td>Ctrl+Space</td>
                    <td>Start Auto Complete (also trigger automtically after typing '.')</td>
                </tr>
                <tr>
                    <td>Ctrl+I</td>
                    <td>Show type</td>
                </tr>
                <tr>
                    <td>Alt+.</td>
                    <td>Jump to definition</td>
                </tr>
                <tr>
                    <td>Alt+,</td>
                    <td>Jump back</td>
                </tr>
                <tr>
                    <td>Ctrl+E</td>
                    <td>Find references (popup posistion has bug)</td>
                </tr>
                <tr>
                    <td>Ctrl+Shift+E</td>
                    <td>Rename (popup posistion has bug)</td>
                </tr>
            </table>
        </div>
        <script>
</script>
        <!-- load ace -->
        <script src="ace-builds/src-noconflict/ace.js"></script>
        <script>
            // set to false to prevent using worker, which is needed to run this from local html file due to browser security restritions
            var useWebWorker = true;
            var editor = ace.edit("editor");
            editor.getSession().setUseWorker(useWebWorker);
            
            //set editor content for demo
            editor.setValue(modeDocs().javascript);
            
            //#region not relevant to tern, just some deafults I prefer
            editor.setTheme("ace/theme/chrome");
            editor.session.setMode("ace/mode/javascript");
            editor.getSession().setUseWrapMode(true);
            editor.getSession().setWrapLimitRange(null, null);
            editor.setShowPrintMargin(false);
            //#endregion
            
            ace.config.loadModule('ace/ext/language_tools', function() {
                ace.config.loadModule('ace/ext/tern', function() {
                    editor.setOptions({
                        /**
                         * Either `true` or `false` or to enable with custom options pass object that 
                         * has options for tern server: http://ternjs.net/doc/manual.html#server_api
                         * If `true`, then default options will be used
                         */
                        enableTern: {
                            /* http://ternjs.net/doc/manual.html#option_defs */
                            defs: ['browser', 'ecma5'],
                            /* http://ternjs.net/doc/manual.html#plugins */
                            plugins: {
                                doc_comment: {
                                    fullDocs: true
                                }
                            },
                            /**
                             * (default is true) If web worker is used for tern server.
                             * This is recommended as it offers better performance, but prevents this from working in a local html file due to browser security restrictions
                             */
                            useWorker: useWebWorker,
                            /* if your editor supports switching between different files (such as tabbed interface) then tern can do this when jump to defnition of function in another file is called, but you must tell tern what to execute in order to jump to the specified file */
                            switchToDoc: function(name, start) {
                                console.log('switchToDoc called but not defined. name=' + name + '; start=', start);
                            },
                            /**
                             * if passed, this function will be called once ternServer is started. 
                             * This is needed when useWorker=false because the tern source files are loaded asynchronously before the server is started.
                             */
                            startedCb: function() {
                                //once tern is enabled, it can be accessed via editor.ternServer
                                console.log('editor.ternServer:', editor.ternServer);
                            },
                        },
                        /**
                         * when using tern, it takes over Ace's built in snippets support.
                         * this setting affects all modes when using tern, not just javascript.
                         */
                        enableSnippets: false,
                        /**
                         * when using tern, Ace's basic text auto completion is enabled still by deafult. 
                         * This settings affects all modes when using tern, not just javascript. 
                         * For javascript mode the basic auto completion will be added to completion results if tern fails to find completions or if you double tab the hotkey for get completion (default is ctrl+space, so hit ctrl+space twice rapidly to include basic text completions in the result)
                         */
                        enableBasicAutocompletion: true,
                    });
                });
            });
            
            //#region not relevant to tern (custom beautify plugin)
            ace.config.loadModule('ace/ext/html_beautify', function() {
                editor.setOptions({
                    autoBeautify: true
                });
            });
            //#endregion
            
            
            //demo documents
            function modeDocs() {
                return {
                    javascript: '//json test object\nvar jsonObject ={\n    //prop one\n    one:"one", \n    //prop two\n    propTwo:"propTwo"\n};\n\n//type a dot after json object and tern will get peropties\njsonObject\n\n/**\n * Description of this fn\n * @param {int} a - first number\n * @param {decimal} b - second number\n * @param {number} [c] - third number to include \n * @param {bool} [useSum=false] - pass true to use sum instead of product\n * @returns {number} the product of the passed parameters \n */\nfunction TestFn(a, b, c, useSum){\n   if (useSum === true) {\n        if (c) return a + b + c;\n        return a + b;\n    }\n    if (c) return a * b * c;\n    return a * b;\n}\n\n//place cursor inside of parenthesis to see argument hints\nvar tmp = TestFn(100,200);\n\n/** \n * test function with object as argument and jsDoc comments that describe the object properties \n * @param {object} obj \n * @param {bool} [obj.boolProp=false] - bool property \n * @param {array} [obj.arrayProp] - array property \n * @param {string} [obj.stringProp=default string] - string property with default \n * @returns {object} passed object with default values set where properties are missing \n */ \nfunction TestObjectArg(obj){ \n\tif (typeof(obj) !== "object") { \n\t\tthrow new Error("obj parameter is required and must be an object"); \n\t} \n\tif (!obj.boolProp) { \n\t\tobj.boolProp = false; \n\t} \n\tif (!Array.isArray(obj.arrayProp)) { \n\t\tobj.arrayProp = []; \n\t} \n\tif (typeof(obj.stringProp) !== "string") { \n\t\tobj.stringProp = "default string"; \n\t} \n\treturn obj; \n}\n\n//place cursor inside of parenthesis to see advanced object arg hints from comments\nTestObjectArg();\n\n\n',
                    html: '<h1>HTML Mode</h1>\n\n<SCRP>\nalert("html mode");\n</SCRP>'
                };
            }
            
            //testing mode changing
            function ChangeMode() {
                var mode = document.getElementById('modeSelect').value;
                editor.session.setMode("ace/mode/" + mode);
                var doc = modeDocs()[mode].replace(/SCRP/g, 'script');
                editor.setValue(doc);
            }
        </script>
        <div id="CurrentToken" style="color:blue; position:fixed; z-index:99; top:5px; right:5px; font-size:11px;"></div>
    </body>

</html>
